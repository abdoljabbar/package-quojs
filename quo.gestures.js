/* QuoJS v3.0.0 - 2013/12/30
   http://quojs.tapquo.com
   Copyright (c) 2013 Javi Jimenez Villar (@soyjavi) - Licensed MIT */
(function(){"use strict";!function($$){var CURRENT_TOUCH,EVENT,FIRST_TOUCH,GESTURE,GESTURES,HOLD_DELAY,TAPS,TOUCH_TIMEOUT,_angle,_capturePinch,_captureRotation,_cleanGesture,_distance,_fingersPosition,_getTouches,_hold,_isSwipe,_listenTouches,_onTouchEnd,_onTouchMove,_onTouchStart,_parentIfText,_swipeDirection,_trigger;return TAPS=null,EVENT=void 0,GESTURE={},FIRST_TOUCH=[],CURRENT_TOUCH=[],TOUCH_TIMEOUT=void 0,HOLD_DELAY=650,GESTURES=["touch","tap","singleTap","doubleTap","hold","swipe","swiping","swipeLeft","swipeRight","swipeUp","swipeDown","rotate","rotating","rotateLeft","rotateRight","pinch","pinching","pinchIn","pinchOut","drag","dragLeft","dragRight","dragUp","dragDown"],GESTURES.forEach(function(event){return $$.fn[event]=function(callback){var event_name;return event_name="touch"===event?"touchend":event,$$(document.body).delegate(this.selector,event_name,callback)},this}),$$(document).ready(function(){return _listenTouches()}),_listenTouches=function(){var environment;return environment=$$(document.body),environment.bind("touchstart",_onTouchStart),environment.bind("touchmove",_onTouchMove),environment.bind("touchend",_onTouchEnd),environment.bind("touchcancel",_cleanGesture)},_onTouchStart=function(event){var delta,fingers,now,touches;return EVENT=event,now=Date.now(),delta=now-(GESTURE.last||now),TOUCH_TIMEOUT&&clearTimeout(TOUCH_TIMEOUT),touches=_getTouches(event),fingers=touches.length,FIRST_TOUCH=_fingersPosition(touches,fingers),GESTURE.el=$$(_parentIfText(touches[0].target)),GESTURE.fingers=fingers,GESTURE.last=now,GESTURE.taps||(GESTURE.taps=0),GESTURE.taps++,1===fingers?(fingers>=1&&(GESTURE.gap=delta>0&&250>=delta),setTimeout(_hold,HOLD_DELAY)):2===fingers?(GESTURE.initial_angle=parseInt(_angle(FIRST_TOUCH),10),GESTURE.initial_distance=parseInt(_distance(FIRST_TOUCH),10),GESTURE.angle_difference=0,GESTURE.distance_difference=0):void 0},_onTouchMove=function(event){var fingers,touches;return EVENT=event,GESTURE.el&&(touches=_getTouches(event),fingers=touches.length,fingers===GESTURE.fingers?(CURRENT_TOUCH=_fingersPosition(touches,fingers),_isSwipe(event)&&_trigger("swiping"),2===fingers&&(_captureRotation(),_capturePinch(),event.preventDefault())):_cleanGesture()),!0},_isSwipe=function(){var it_is,move_horizontal,move_vertical;return it_is=!1,CURRENT_TOUCH[0]&&(move_horizontal=Math.abs(FIRST_TOUCH[0].x-CURRENT_TOUCH[0].x)>30,move_vertical=Math.abs(FIRST_TOUCH[0].y-CURRENT_TOUCH[0].y)>30,it_is=GESTURE.el&&(move_horizontal||move_vertical),GESTURE.prevSwipe=it_is),it_is},_onTouchEnd=function(event){var anyevent,drag_direction,pinch_direction,rotation_direction,swipe_direction;return EVENT=event,_trigger("touch"),1===GESTURE.fingers?2===GESTURE.taps&&GESTURE.gap?(_trigger("doubleTap"),_cleanGesture()):_isSwipe()||GESTURE.prevSwipe?(_trigger("swipe"),swipe_direction=_swipeDirection(FIRST_TOUCH[0].x,CURRENT_TOUCH[0].x,FIRST_TOUCH[0].y,CURRENT_TOUCH[0].y),_trigger("swipe"+swipe_direction),_cleanGesture()):(_trigger("tap"),1===GESTURE.taps&&(TOUCH_TIMEOUT=setTimeout(function(){return _trigger("singleTap"),_cleanGesture()},100))):(anyevent=!1,GESTURE.angle_difference&&(_trigger("rotate",{angle:GESTURE.angle_difference}),rotation_direction=GESTURE.angle_difference>0?"rotateRight":"rotateLeft",_trigger(rotation_direction,{angle:GESTURE.angle_difference}),anyevent=!0),GESTURE.distance_difference&&(_trigger("pinch",{angle:GESTURE.distance_difference}),pinch_direction=GESTURE.distance_difference>0?"pinchOut":"pinchIn",_trigger(pinch_direction,{distance:GESTURE.distance_difference}),anyevent=!0),!anyevent&&CURRENT_TOUCH[0]&&(Math.abs(FIRST_TOUCH[0].x-CURRENT_TOUCH[0].x)>10||Math.abs(FIRST_TOUCH[0].y-CURRENT_TOUCH[0].y)>10)&&(_trigger("drag"),drag_direction=_swipeDirection(FIRST_TOUCH[0].x,CURRENT_TOUCH[0].x,FIRST_TOUCH[0].y,CURRENT_TOUCH[0].y),_trigger("drag"+drag_direction),anyevent=!0),_cleanGesture()),EVENT=void 0},_fingersPosition=function(touches,fingers){var i,result;for(result=[],i=0,touches=touches[0].targetTouches?touches[0].targetTouches:touches;fingers>i;)result.push({x:touches[i].pageX,y:touches[i].pageY}),i++;return result},_captureRotation=function(){var angle,diff,i,symbol;if(angle=parseInt(_angle(CURRENT_TOUCH),10),diff=parseInt(GESTURE.initial_angle-angle,10),Math.abs(diff)>20||0!==GESTURE.angle_difference){for(i=0,symbol=GESTURE.angle_difference<0?-1:1;Math.abs(diff-GESTURE.angle_difference)>90&&i++<10;)diff+=180*symbol;return GESTURE.angle_difference=parseInt(diff,10),_trigger("rotating",{angle:GESTURE.angle_difference})}},_capturePinch=function(){var diff,distance;return distance=parseInt(_distance(CURRENT_TOUCH),10),diff=GESTURE.initial_distance-distance,Math.abs(diff)>10?(GESTURE.distance_difference=diff,_trigger("pinching",{distance:diff})):void 0},_trigger=function(type,params){return GESTURE.el?(params=params||{},CURRENT_TOUCH[0]&&(params.iniTouch=GESTURE.fingers>1?FIRST_TOUCH:FIRST_TOUCH[0],params.currentTouch=GESTURE.fingers>1?CURRENT_TOUCH:CURRENT_TOUCH[0]),GESTURE.el.trigger(type,params,EVENT)):void 0},_cleanGesture=function(){return FIRST_TOUCH=[],CURRENT_TOUCH=[],GESTURE={},clearTimeout(TOUCH_TIMEOUT)},_angle=function(touches_data){var A,B,angle;return A=touches_data[0],B=touches_data[1],angle=Math.atan(-1*(B.y-A.y)/(B.x-A.x))*(180/Math.PI),0>angle?angle+180:angle},_distance=function(touches_data){var A,B;return A=touches_data[0],B=touches_data[1],-1*Math.sqrt((B.x-A.x)*(B.x-A.x)+(B.y-A.y)*(B.y-A.y))},_getTouches=function(event){return $$.isMobile()?event.touches:[event]},_parentIfText=function(node){return"tagName"in node?node:node.parentNode},_swipeDirection=function(x1,x2,y1,y2){var xDelta,yDelta;return xDelta=Math.abs(x1-x2),yDelta=Math.abs(y1-y2),xDelta>=yDelta?x1-x2>0?"Left":"Right":y1-y2>0?"Up":"Down"},_hold=function(){return GESTURE.last&&Date.now()-GESTURE.last>=HOLD_DELAY?(_isSwipe()||_trigger("hold"),GESTURE.taps=0):void 0}}(Quo)}).call(this);